/* ==UserStyle==
@name         Dark-WhatsApp
@description  Dark and light, very customizable theme for WhatsApp.
@namespace    github.com/vednoc/dark-whatsapp
@homepageURL  https://github.com/vednoc/dark-whatsapp
@supportURL   https://github.com/vednoc/dark-whatsapp/issues
@updateURL    https://raw.githubusercontent.com/vednoc/dark-whatsapp/master/wa.user.styl
@version      2.3.2
@author       vednoc <vednoc@pm.me> (https://github.com/vednoc)
@license      MIT
@preprocessor stylus

@var text     ui_font    'Custom UI font' ''font_name''
@var text     radius-g   'Custom rounded corners for menus' 4px
@var text     radius-i   'Custom rounded corners for input area' 4px
@var range    radius-a   'Custom rounded corners for avatars' [50, 0, 50, 1, '%']
@var text     app_width  'Custom width for chat app' 1396px
@var checkbox fullscreen 'Enable fullscreen mode' 0
@var checkbox app_c_m    'Enable compact mode' 1
@var text     app_c_m_w  'Compact mode breakpoint' 720px
@var text     app_c_m_h  'Compact mode on-hover delay' 1s

@var checkbox chat_b_c   'Enable blurred contacts' 0
@var checkbox chat_b_img 'Enable blurred images/videos' 0

@var select   alerts     'Alerts' {
    'Show all                   *': 'show          ',
    'Hide "Allow notifications"  ': 'notifications ',
    'Hide all                    ': 'hide          ',
}

@var select   chat_m_t   'Message tails style' {
    'Default  *': 'default ',
    'Minimal   ': 'minimal ',
    'Rounded   ': 'rounded ',
    'Facebook  ': 'fb-like ',
}

@var select   chat_left  'Left message bubble position' {
    'Left side  *': 'start ',
    'Right side  ': 'end   ',
}
@var checkbox chat_b_l   'Custom background for left message bubble' 0
@var color    b_l_bg     'Left message bubble color' #3c434f
@var select   chat_right 'Right message bubble position' {
    'Left side   ': 'start ',
    'Right side *': 'end   ',
}
@var checkbox chat_b_r   'Custom background for right message bubble' 0
@var color    b_r_bg     'Right message bubble color' #333a47

@var checkbox emoji_ti   '[BROKEN]: Enable transparent emoji images' 0
@var range    emoji_o    'Emoji default opacity' [0.8, 0.0, 1, 0.01]

@var select   app_image  'Custom app background' {
    'Theme image with 12px blur   *': 'bg-high ',
    'Theme image with 6px blur     ': 'bg-low  ',
    'Theme image without blur      ': 'bg-none ',
    'Custom background image       ': 'custom  ',
    'Default background            ': 'default ',
    'None                          ': 'none    ',
}
@var text     image_url  'Custom background image link' url('https://images.unsplash.com/photo-1434569117012-ce134ee1a088?fit=crop&w=1280&h=720&q=80')
@var range    bg_opacity 'Background image opacity' [0.4, 0.0, 1, 0.01]
@var range    bg_blur    'Background image blur size' [0, 0, 50, 1, 'px']
@var range    bg_hue     'Background image hue' [320, 0, 360, 1, 'deg']
@var range    bg_invert  'Background image invert colors' [0, 0.0, 1, 0.1]

@var checkbox chat_bg    'Enable chat background image' 1
@var text     chat_image 'Custom image for chat' url('https://web.whatsapp.com/img/bg-chat-tile_9e8a2898faedb7db9bf5638405cf81ae.png')
@var range    chat_bg_o  'Chat background image opacity' [0.15, 0.0, 1, 0.01]
@var range    chat_bg_i  'Chat background image inverted colors' [0.6, 0.0, 1, 0.1]

@var checkbox ff_scroll  'Thin scrollbars in Firefox' 1

@var checkbox c_g_c      'Theme colors in groups' 1

@var select   theme      'Color-scheme' {
    'Dark blue (old) *': 'old',
    'Dark gray (new)  ': 'new',
    'Custom colors    ': 'custom',
}

@var color    dark       'Color: Primary background   ' #1f232a
@var color    darken     'Color: Highlight background ' #252A33
@var color    darker     'Color: Secondary background ' #333943
@var color    light      'Color: Primary foreground   ' #e9e9e9
@var color    lighter    'Color: Secondary foreground ' #a1a1a1
@var color    accent     'Color: Accent               ' #7289da
@var color    yellow     'Color: Yellow               ' #e5c512
@var color    orange     'Color: Orange               ' #df4b16
@var color    red        'Color: Red                  ' #dc322f
@var color    magenta    'Color: Magenta              ' #f33682
@var color    violet     'Color: Violet               ' #6c71c4
@var color    blue       'Color: Blue                 ' #268bd2
@var color    cyan       'Color: Cyan                 ' #2aa198
@var color    green      'Color: Green                ' #859900
@var color    white      'Color: White                ' #ffffff
@var color    sh         'Color: Shadow light         ' #00000025
@var color    sh-h       'Color: Shadow heavy         ' #00000035
==/UserStyle== */

@-moz-document domain('web.whatsapp.com') {
    // CSS custom properties.
    :root {
        /// Feat -> Thin scrollbar in Firefox.
        if ( ff_scroll == 1 ) {
            @supports (-moz-user-select: none) {
                * { scrollbar-width: thin }
            }
        }
        /// Feat -> Toggle between themes. #32
        if ( theme == 'old' ) {
            --dark      : #1f232a;
            --darken    : #252a33;
            --darker    : #333943;
            --light     : #e9e9e9;
            --lighter   : #a1a1a1;
            --accent    : #7289da;
            --msg-l     : lighten(#2c313a, 5%);
            --msg-r     : lighten(#252a33, 4%);
        } else if ( theme == 'new' ) {
            --dark      : #292929;
            --darken    : #333333;
            --darker    : #424242;
            --light     : #e6e6e6;
            --lighter   : #bababa;
            --accent    : #bf692b;
            --msg-l     : lighten(#424242, 5%);
            --msg-r     : lighten(#333333, 4%);
        } else {
            --dark      : dark;
            --darken    : darken;
            --darker    : darker;
            --light     : light;
            --lighter   : lighter;
            --accent    : accent;
            --msg-l     : lighten(darker, 5%);
            --msg-r     : lighten(darken, 4%);
        }
        --yellow    : yellow;
        --orange    : orange;
        --red       : red;
        --magenta   : magenta;
        --violet    : violet;
        --blue      : blue;
        --cyan      : cyan;
        --green     : green;
        --white     : white;
        --radius    : radius-g;
        --t         : transparent;
        --shadow    : sh;
        --sh-h      : sh-h;
        --bshadow   : 0 2px 4px var(--shadow);

        --app-width : app_width;

        --emoji-o   : emoji_o;

        --avatar-r  : radius-a;

        /// Feat -> Background image dropdown.
        if ( app_image == bg-high ) {
            --bg-image: url('https://raw.githubusercontent.com/vednoc/dark-whatsapp/master/images/bg-blur-high.jpg');
        } else if ( app_image == bg-low ) {
            --bg-image: url('https://raw.githubusercontent.com/vednoc/dark-whatsapp/master/images/bg-blur-low.jpg');
        } else if ( app_image == bg-none ) {
            --bg-image: url('https://raw.githubusercontent.com/vednoc/dark-whatsapp/master/images/bg-blur-none.jpg');
        } else if ( app_image == custom ) {
            --bg-image: image_url;
        } else {
            --bg-image: none;
        }
        --bg-opacity: bg_opacity;
        --bg-blur   : bg_blur;
        --bg-hue    : bg_hue;
        --bg-invert : bg_invert;

        --chat-image: chat_image;
        --chat-bg-o : chat_bg_o;
        --chat-bg-i : chat_bg_i;

        --c-m-hover : app_c_m_h;

        --ui-font   : ui_font, 'Segoe UI', 'Helvetica Neue', Helvetica,
            'Lucida Grande', Arial, Ubuntu, Cantarell, 'Fira Sans', sans-serif;

        --version   : 'Dark-WhatsApp v2.3.2 â€” March 27th, 2020';
        --message   : 'Another update is out, report broken things on GitHub so that we can fix them. ðŸŽ‰ ðŸ¥³ I published an important update about my userstyles, please read it: ';
        --changes   : 'https://vednoc.me/blog/the-end-of-an-era';
    }

    // Use stylus-lang variables with CSS variables.
    bg      = var(--dark);
    hl      = var(--darken);
    bd      = var(--darker);
    msg_l   = var(--msg-l);
    msg_r   = var(--msg-r);
    fg      = var(--light);
    cm      = var(--lighter);
    ac      = var(--accent);
    sh      = var(--shadow);
    sh-h    = var(--sh-h);
    bsh     = var(--bshadow);
    yellow  = var(--yellow);
    orange  = var(--orange);
    red     = var(--red);
    magenta = var(--magenta);
    violet  = var(--violet);
    blue    = var(--blue);
    cyan    = var(--cyan);
    green   = var(--green);
    white   = var(--white);
    t       = var(--t);
    r       = var(--radius);
    outer   = 0 0 0 1px bd;
    inner   = inset outer;
    i       = !important;

    // Color mixin.
    /// All colors: `c: fg bd bg;`
    /// Only border-color: `c: 0 bd;`
    c(x, y = 0, z = 0, xi = 1, yi = 1, zi = 1) {
        i = !important;
        if x is a 'call' or x is a 'rgba' {            color: xi is 0? x : x i }
        if y is a 'call' or y is a 'rgba' {     border-color: yi is 0? y : y i }
        if z is a 'call' or z is a 'rgba' { background-color: zi is 0? z : z i }
    }
    // SVG mixin.
    /// Same usage as for `c` mixin.
    v(x, y = 0, xi = 1, yi = 1) {
        i = !important;
        if x is a 'call' or x is a 'rgba' {   fill: xi is 0? x : x i }
        if y is a 'call' or y is a 'rgba' { stroke: yi is 0? y : y i }
    }
    // Rounded corners.
    rad() { border-radius: arguments }

    /// Typing indicator animation.
    @keyframes pulse {
        40% { opacity: 0 }
        80% { opacity: 1 }
    }

    // Base styles.
    body {
        c: fg 0 bg;
        background-image: none;
        scrollbar-color: ac #55555520;

        /// Input/preloader color.
        ::placeholder, ._1mpL5 { c: cm }
        strong, [contenteditable] { c: fg }
        a { color: ac }
        select {
            c: fg bd;
            /.uyEaY {
                margin-right: 24px;
                /// Caret.
                &::before { c: cm }
            }
        }
        option { c: fg 0 bd }

        /// Browser-specific resets.
        ::-moz-range {
            &-progress { c: 0 0 blue }
            &-thumb { c: 0 0 ac }
            &-track { c: 0 0 bg }
            /// Global -> Progress completed.
            ../ ._1N8Pv { c: 0 0 ac }
            /// Chat -> Played state for audio messages.
            /.bB3vH ._4_92b::-moz-range-thumb { c: 0 0 green }
        }
        ::-webkit- {
            &progress {
                &-bar { c: 0 0 bd }
                &-value { c: 0 0 ac }
            }
            &slider {
                &-runnable-track { c: 0 0 gray }
                &-thumb {
                    c: 0 0 ac;
                    /// Chat -> Played state for audio messages.
                    /.bB3vH ._4_92b::-moz-range-thumb { c: 0 0 green }
                }
            }
            &scrollbar {
                &-track { background-color: #5552 }
                &-thumb { background-color: ac }
            }
        }

        /// Feat -> Custom font.
        &, button, input { font-family: var(--ui-font) }

        /// App -> Landing page.
        .landing {
            &-wrapper::before { c: 0 0 hl }
            &-header {
                position: relative;
                /// WhatsApp logo.
                path[fill ^= '#FFF'] { fill: ac }
                path[fill ^= '#00E'] { fill: bg }
                div { text-transform: unset; c: fg }
                /// Userstyle version.
                &::after {
                    right: 0;
                    font-size: 14px;
                    font-weight: 500;
                    position: absolute;
                    content: var(--version);
                }
            }
            &-window:not(#z) {
                rad: r;
                c: 0 0 bg;
                box-shadow: inner, bsh;
            }
            &-main {
                a[href] { c: ac }
                label, ._2yUXW { c: cm }
                .landing-title { c: fg }
                rect[fill ^= '#f2f'], rect[fill ^= '#F2F'] { fill: bd }
                path[fill ^= '#818'] { fill: ac }
                /// QR code.
                div[data-ref] {
                    rad: 0;
                    filter: contrast(150%);
                    outline: 4px solid white;
                    box-shadow: 0 0 0 4px white;
                    [role='button'] { c: white 0 ac }
                    /// Change white border when inactive.
                    &._1-KGg {
                        outline: 4px solid ac;
                        box-shadow: 0 0 0 4px ac;
                    }
                }
                /// Video tutorial.
                + ._3B9bf {
                    c: 0 0 t;
                    img { opacity: 0.3 }
                    /// Reset background on button container.
                    [style *= 'opacity: 1'] { c: 0 0 t }
                }
                /// 'Keep me signed in' tooltip. #59
                .KACnm {
                    c: white 0 ac;
                    box-shadow: bsh;
                    &::before { border-bottom-color: ac }
                }
            }
        }

        /// App -> Startup.
        [id *= 'startup'] {
            c: 0 0 bg;
            progress { c: ac 0 bd }
            ::-moz-progress-bar { c: 0 0 ac }
            circle { stroke: fg }
        }

        /// App -> Tooltips.
        .hYvJ8 {
            c: fg 0 hl;
            box-shadow: inner, bsh;
            button { c: ac }
        }

        /// App -> Badges.
        ._3JEcM { c: cm cm hl }
        ._2e8Mu { c: ac ac hl }

        /// App -> Intro.
        ._2zynu {
            c: 0 bd bg;
            a { color: ac }
            &::after { c: 0 ac }
            [style] {
                h1 { c: fg }
                div { c: cm }
            }
            /// Reset default image.
            [data-asset-intro-image] {
                rad: 50%;
                max-width: 200px;
                max-height: 200px;
                filter: opacity(0.75);
                transition: opacity 0.6s ease;
            }
            /// Userstyle info.
            h1 + div[class] {
                font-size: 0;
                &::before {
                    display: block;
                    font-size: 16px;
                    margin-bottom: -16px;
                    content: var(--message) var(--changes);
                }
                &::after {
                    display: block;
                    font-size: 16px;
                    margin-top: 16px;
                    padding-top: 16px;
                    content: var(--version);
                    border-top: 1px solid bd;
                }
            }
            /// Platform-specific section border.
            ._3ZVgT { c: 0 0 bd }
        }

        /// Intro alert for desktop applications.
        .IMBOA { margin-top: 16px i }
        ._2a2hS { c: 0 0 bd }

        /// Left -> Typing indicator.
        span[title *= 'typing...'], ._2ZAIy { c: ac }

        /.matched {
            /// Global -> Matched text.
            &-text:not(#z) { c: ac }
            /// Global -> Mentions.
            &-mention, /[data-mention-jid] {
                span { c: ac }
                &:hover span { text-decoration: underline i }
            }
        }

        /// Global -> Checkboxes.
        /.me9CP { c: 0 cm hl }
        /._1VD7W { c: 0 ac ac }

        /// Global -> Active buttons.
        .rAUz7 {
            path:not([fill = '#009588']) { fill-opacity: 0.55 }
            &._3TbsN {
                c: 0 0 bd;
                /// Chat -> Reset opacity for attach menu items.
                &:not(#z):not(#y) [data-icon] path { fill-opacity: 1 i }
            }
        }

        /// Chat -> Download media/sticker buttons.
        ._10YBz, ._3UAb1 {
            c: fg 0 bg;
            opacity: 0.75;
            box-shadow: bsh;
            svg path { v: fg }
        }

        /// Contacts/Search -> Loader.
        svg[width = '18'][height = '18'],
        svg[width = '20'][height = '20'] {
            circle { stroke: green }
        }
        svg[width = '34'][height = '34'] {
            circle { stroke: cm }
        }

        /// Panes -> Change avatar hover animation.
        .WX_XW {
            c: fg 0 #19191980;
            rad: 0 i;
        }

        /// Group invite link.
        #group-invite-link-anchor { c: ac }

        /// Global -> Media player.
        /._2jPGD {
            c: 0 0 bd;
            /// Reset input.
            ._3y8EC {
                &::-webkit-slider-runnable-track { c: 0 0 t }
                &::-moz-range { &-progress, &-track { c: 0 0 t }}
            }
            /// Progress bar.
            ._1y1Zk { c: 0 0 ac }
            /// Audio level in Chromium.
            /._9sTVb:not(#z) {
                div { c: 0 0 ac }
                ::-webkit-slider {
                    &-runnable-track { c: 0 0 #88888840 }
                }
            }
            /// Audio message length in Chromium.
            /._3L8ub .Q8uSF { c: 0 0 ac }
            // Audio level in Firefox.
            /.Q8uSF {
                c: 0 0 t;
                + ::-moz-range {
                    &-progress, &-thumb { c: 0 0 ac }
                    &-track { height: 2px; c: 0 0 gray }
                    /// Track default color.
                    /._4_92b::-moz-range-track { c: 0 0 gray }
                    /// Thumb default color.
                    /._3L8ub ._4_92b::-moz-range-thumb { c: 0 0 fg 0 0 0 }
                    /// Playing state.
                    /.bB3vH._38DlQ ._4_92b::-moz-range-thumb { c: 0 0 ac }
                }
            }
            /// Fix box-shadow.
            /.llRZq { box-shadow: 0 4px 12px 2px sh-h i }
        }
    }

    // App -> Base styles.
    #app > div {
        /// Feat -> App background.
        &::after {
            if ( app_image != none && app_image != default ) {
                s = calc(-2 * var(--bg-blur));
                b = blur(var(--bg-blur));
                o = opacity(var(--bg-opacity));
                i = invert(var(--bg-invert));
                h = hue-rotate(var(--bg-hue));
                top: s; right: s; bottom: s; left: s;
                height: unset; width: unset;
                filter: b o i h;
                background-image: var(--bg-image);
                background-size: cover;
                c: 0 0 t;
            } else if ( app_image == default ) {
                c: 0 0 hl;
            } else {
                display: none;
            }
            /// Remove image in fullscreen mode.
            if ( fullscreen == 1 ) { content: none i }
        }
        /// Resets.
        .app {
            c: 0 0 bg;
            background-image: none;
            @media (min-width: 1441px) {
                border: 1px solid bd;
                rad: r;
                box-shadow: bsh;
                /// Feat -> Custom max-width.
                &, /._11ARv {
                    width: calc(100% - 38px);
                    max-width: var(--app-width);
                }
                /// Feat -> Fullscreen mode.
                if ( fullscreen == 1 ) {
                    &, /._11ARv {
                        rad: 0;
                        top: unset;
                        width: 100%;
                        max-width: 100%;
                        height: 100%;
                    }
                }
            }
            /// Right -> Fix the width with three open panes.
            &.three > ._37f_5 { width: calc(100% + 1px) }
            /// HACK: Resolve gap/border between panes.
            ._2rI9W { margin-right: -1px }
        }
    }

    // Global -> Avatars.
    /// Profile and Chat avatars (without quoted contacts);
    /// New group and 'No blocked contacts yet' icons.
    ._1WliW, ._1jJLh, ._2Lev2 {
        rad: var(--avatar-r) i;
        c: 0 0 bg;
        > img { rad: var(--avatar-r) i }
        /// Tweak default-user icons.
        if ( radius-a != '50%' ) {
            /[style *= 'height: 26px'],
            /[style *= 'height: 40px'],
            /[style *= 'height: 49px'],
            /[style *= 'height: 55px'],
            /[style *= 'height: 82px'],
            /[style *= 'height: 200px'] {
                [data-icon = 'default-user'] svg {
                    margin-top: -4px;
                    transform: scale(0.7) i;
                }
            }
        }
    }

    // Global -> Emojis.
    .emojik {
        transition: transform 0.15s ease;
        /// Default opacity.
        &:not(:hover):not(:focus):not(.selected) {
            filter: opacity(var(--emoji-o));
        }
        /// Active state.
        &:hover, &:focus, &.selected {
            opacity: 1;
            transform: scale(1.2);
            box-shadow: none i;
        }
        /// Feat -> Transparent emoji images.
        if ( emoji_ti == 1 ) {
            repo = 'https://raw.githubusercontent.com/vednoc/wae/master'
            /// Android emojis.
            for i in 0..112 {
                &.wa.b{i} {
                    background-image: url(s('%s/a/%s.webp', unquote(repo), i))
                }
            }
            /// iOS emojis.
            for i in 0..116 {
                &.apple.b{i} {
                    background-image: url(s('%s/i/%s.webp', unquote(repo), i))
                }
            }
        } else {
            clip-path: circle(49%);
        }
    }

    // Global -> Emoji picker popout.
    ._3ZkhL._3NVMy {
        rad: r i;
        box-shadow: bsh;
        /// Header.
        ._1qUma {
            c: 0 0 hl;
            box-shadow: inset 0 -1px bd;
            [style] { c: 0 0 ac }
        }
        /// Content.
        ._3tlsa {
            c: 0 0 bg;
            [data-tab] {
                c: 0 0 bg;
                /// Input.
                label {
                    c: fg 0 hl;
                    box-shadow: inner;
                }
                input { c: fg }
            }
            /// Sections.
            ._3xMAk { c: cm }
        }
        /// Nib.
        + [data-animate-dropdown-nib] {
            border-bottom: 1px solid bd;
            border-right: 1px solid bd;
            c: 0 0 bg;
            box-shadow: none;
        }
    }

    // Global -> Modals.
    .overlay {
        c: 0 0 t;
        /// Backdrop.
        &::before {
            content: '';
            z-index: -1;
            opacity: 0.81;
            position: absolute;
            top: 0; right: 0; bottom: 0; left: 0;
            c: 0 0 bg;
        }
        /// Header.
        ._2YdsD, ._3pRd1 {
            c: 0 0 hl;
            box-shadow: 0 1px bd;
            /// Text.
            ._1AwDx { c: cm }
            ._25Ooe { c: fg }
            /// Media -> Fix header background hover conflict.
            ._2EXPL:not(#z):hover { c: 0 0 t }
        }
        /// Add group participants.
        .I72vi {
            c: 0 0 hl;
            overflow: hidden;
            box-shadow: 0 1px bd;
            > div:not(#z) {
                c: 0 0 t;
                border: none i;
                > div { c: 0 0 bd }
            }
        }
        /// Footer.
        ._21bWq { c: 0 0 hl }
        /// Previous/next buttons.
        .KNt1E:not(#z) {
            c: 0 0 hl;
            box-shadow: inner, bsh;
            &:hover { c: 0 0 bd }
        }
        /// Text.
        .X5OiD { c: 0 0 bd }
        ._26BZr, .JmH7x { c: cm }
        ._2yVvV { c: fg }
        /// Buttons.
        [role = 'button'] {
            &._1WZqU {
                c: cm;
                &:hover {
                    c: fg 0 hl;
                    box-shadow: none;
                }
            }
            /// Primary.
            &._1WZqU.PNlAR {
                c: white 0 ac;
                box-shadow: bsh;
                transition: 0.15s ease;
                &:hover { opacity: 0.8 }
            }
        }
        /// Popup message.
        [data-animate-modal-popup]:not(._2ILbv) {
            border: 1px solid bd;
            rad: r;
            c: 0 0 bg;
            box-shadow: 0 4px 8px 2px sh;
            ._13HPh { c: fg }
            ._2VDPW { c: 0 0 hl }
            /// Contacts popup -> Forward message / Message group admins.
            .copyable-area {
                c: 0 0 t;
                > header {
                    border-bottom: 1px solid bd;
                    c: fg 0 hl;
                }
                ._1AKfk { c: ac 0 t }
                ._2UaNq { c: fg 0 t }
                /// Footer.
                > span > div[style] {
                    border-top: 1px solid bd;
                    c: fg 0 hl;
                    [role = 'button'] {
                        c: 0 0 ac;
                        box-shadow: bsh;
                    }
                }
            }
            /// Failed to connect.
            span[role = 'button'] { c: ac }
            hr {
                c: 0 bd;
                + div { c: fg }
            }
            /// Inner padding tweak.
            /._1CnF3 {
                padding: 0 i;
                > div { padding: 22px 24px 20px i }
            }
        }
        /// Settings -> Upload a new avatar.
        [data-animate-modal-body] {
            ._1BdTk { border-left: none }
            /// Canvas background.
            ._7RNZ3 { c: 0 0 hl }
            /// Buttons.
            ._2LALH {
                c: 0 0 hl;
                box-shadow: bsh;
            }
            /// Footer.
            ._2HyTU, ._22aOT {
                min-height: 91px; /// NOTE: Border is hidden on default 90px.
                c: 0 0 hl;
                box-shadow: inset 0 1px bd;
            }
        }
        /// View contact.
        ._1VwzF {
            c: 0 0 t;
            ._1VI-m { c: fg }
            [role = 'button'] { c: 0 0 ac }
        }
        /// Contact/group -> Profile image.
        ._8icek { fill-opacity: 0.55 }
        /// View group invite.
        ._2Vo52 {
            /// Header.
            .XOIaT { c: 0 0 hl }
            /// Text.
            ._1WSDe { c: fg }
            ._3WFBR, .vJCph, ._2oG62 { c: cm }
        }
        /// Send/view contacts.
        .WOXAS, ._1v8mQ {
            c: 0 0 t;
            box-shadow: 0 1px bd i ;
            /.fwByR { c: ac }
        }
        /// Settings -> Help.
        ._1wt6r, /._3Yulp, /.bHCVK { c: cm }
        ._3hnO5 { c: 0 ac }
        ._1T8rb { c: ac 0 t }
        /// Left -> Turn on desktop notifications.
        .NWyjc.AZ3xD { margin: 16px }
        /// Left -> Show previews for notifications.
        /.cFkAx._2ojWN ._3FR9x { c: fg }
    }

    // Global -> Status.
    [data-animate-status-v3-modal-background = 'true'] {
        c: 0 0 t;
        /// Backdrop.
        &::before {
            content: '';
            z-index: -1;
            opacity: 0.81;
            position: absolute;
            top: 0; right: 0; bottom: 0; left: 0;
            c: 0 0 bg;
        }
        /// Content.
        > div {
            c: 0 0 bg;
            @media (min-width: 1441px) {
                rad: r i;
                border: 1px solid bd i;
            }
            hr {
                opacity: 1 i;
                border: none i;
                border-top: 1px solid bd i;
            }
            /// Contacts.
            > div[class]:nth-child(1) {
                c: 0 0 hl;
                box-shadow: 1px 0 bd;
                @media (min-width: 1441px) { rad: r 0 0 r }
                /// Text.
                .OEFaY { c: cm }
                ._26-u- { c: fg }
            }
            > div[class]:nth-child(2) {
                ._2LuDL { c: cm }
                /// Reset the circle icon.
                svg[width][height] path { v: cm }
            }
            /// Remove borders from list items.
            ._2EXPL { border-top: none }
            /// Reply to the status.
            /.QRsOy { c: 0 0 bg }
            /// Feat -> Fullscreen mode.
            if ( fullscreen == 1 ) {
                rad: 0;
                top: unset;
                width: 100%;
                height: 100%;
            }
        }
        /// Status icon state.
        /circle {
            v: 0 cm;
            &._1tACm { v: 0 ac }
        }
    }

    // Global -> Media selection.
    .C73Q6 {
        c: 0 bd hl;
        /// Item reset.
        .UPNDG {
            &._1xQmx {
                border: none i;
                outline: 4px solid ac;
            }
            &:hover:not(._1xQmx):not(#z) { outline: 4px solid ac i }
        }
    }

    // Global -> Icons.
    span[class] {
        &[data-icon] {
            > svg > path {
                fill: fg;
                transition: 0.15s ease;
            }
            /// Hover animation.
            &:hover > svg > path {
                opacity: 1;
                fill-opacity: 1 i;
            }
            /// Hover animation.
            &[data-icon *= 'chevron-'],
            &[data-icon = 'down-context'] {
                > svg > path { fill-opacity: 0.55 }
            }
            /// Exclude logos in embedded links from hover animation.
            &[data-icon*='logo-'] > svg > path {
                fill-opacity: 0.6 i;
                &:first-child { fill: bg }
                &:last-child { fill: fg }
            }
            /// Exclude from hover animation.
            &[data-icon='muted'],           // muted chat
            &[data-icon='pinned'],          // pinned chat
            &[data-icon='status-image'],    // image
            &[data-icon='status-video'],    // video
            &[data-icon='status-gif'],      // gif
            &[data-icon='status-vcard'],    // contact
            &[data-icon='status-sticker'],  // sticker
            &[data-icon='status-document'], // document
            &[data-icon='status-ptt-gray'], // your audio message
            &[data-icon='recalled-in'],     // deleted message
            &[data-icon='recalled-out'] {   // deleted message
                > svg > path { fill-opacity: 0.25 i }
            }
            &[data-icon='forwarded'] {      // forwarded message
                > svg > path { fill-opacity: 0.55 i }
            }
        }
        /// Left -> Reset status/chat/menu icons.
        &[data-icon = 'status-v3'] path { fill-opacity: 0.55 i }
        &[data-icon = 'status-v3-unread'] path {
            &:not(:last-child) { fill-opacity: 0.55 i }
            &:last-child { v: ac }
        }
        &[data-icon = 'chat'] path { fill-opacity: 0.55 i }
        &[data-icon = 'menu'] path { fill-opacity: 0.55 i }
        /// Search -> Back button.
        &[data-icon = 'back-blue'] path { v: blue }
        /// Default user/group/broadcasts icons.
        &[data-icon ^= 'default-'] path {
            &:first-child { fill: bg }
            &:last-child { fill: cm }
        }
        /// Chat -> Default avatars in replies.
        &[data-icon $= '-square'] path:first-child { fill: t }
        /// Business accounts.
        &[data-icon ^= 'business-'] path { fill: cm }
        /// Audio files.
        &[data-icon = 'audio-file'] path {
            &:first-child { fill: orange }
            &:last-child { fill: hl }
        }
        &[data-icon ^= 'ptt-'] path {
            &:first-child { fill: bd }
            &:last-child { fill: ac }
        }
        /// Message info -> Played audio message.
        &[data-icon *= 'ptt-blue'] path { v: ac }
        /// Chat -> Played state for audio messages.
        &[data-icon *= 'in-green'] path[fill = '#09D261'] { v: green }
        /// Message status.
        &[data-icon *= '-check'] path { v: cm }
        &[data-icon *= '-dblcheck'] path { v: cm }
        &[data-icon *= '-dblcheck-ack'] path,
        /// Left -> Contacts. |
        /.a5DO0 span[data-icon *= '-dblcheck'] path { v: ac }
        /// Zzz | Chat | Message info.
        /._2lSfP, /._1xtH9, /.wrS81 {
            &[data-icon *= '-dblcheck']:not(#z) path { v: ac }
        }
        &[data-icon *= 'check'] path { fill-opacity: 1 i }
        /// Exit/Report.
        &[data-icon = 'exit'],
        &[data-icon = 'thumbs-down'],
        /// Delete chat/missed call.
        &[data-icon = 'delete-danger'],
        &[data-icon ^= 'miss'] {
            path { v: red }
        }
        /// Right -> Default avatar loader.
        /svg[width = '50'][height = '50'] > circle[fill] { stroke: cm }
        /// Chat -> Sticker bg.
        &[data-icon = 'sticker-placeholder'] > svg > path {
            fill: bd;
            fill-opacity: 0.6;
        }
        /// Right -> Group search.
        &[data-icon = 'search'] {
            path[fill-opacity = '.3'] { fill-opacity: 0.55 }
        }
        /// Right -> Selected media.
        &[data-icon = 'checkbox-round-checked'] {
            [fill = '#00BFA5'] { v: ac }
            [fill = '#FFF'] { v: white }
        }
        /// Contacts -> Audio message.
        &[data-icon *= 'status-ptt-green'] > svg > path { fill: ac }
        /// Global -> Starred messages.
        &[data-icon = 'star'], &[data-icon = 'star-in'], &[data-icon = 'star-light'] {
            > svg > path {
                opacity: 1;
                fill: ac;
            }
        }
        /// Global -> Down arrow animation.
        &[data-icon = 'down'] {
            fill-opacity: 0.55;
            path { v: white }
        }
    }

    // Global -> Context menu.
    div:not(#z) {
        &[style ^= 'transform-origin:'] {
            border: 1px solid bd;
            rad: r;
            c: 0 0 hl;
            box-shadow: 0 4px 12px sh-h;
            /// Headers.
            ul > div { c: fg }
            /// Items.
            li {
                transition: background 0.2s ease;
                &._1exov { c: 0 0 bd }
                div, span {
                    c: cm;
                    transition: 0.2s ease;
                    &:hover { svg path { fill-opacity: 1 i }}
                    ../:hover {
                        c: 0 0 bd;
                        div, span { c: fg }
                    }
                }
                /// Icons -> Exclude labels.
                &:not(:hover) [data-icon] path { fill-opacity: 0.55 i }
            }
            /// Chat -> Attach dropdown.
            &.XhRTI {
                c: 0 0 t;
                border: none i;
                box-shadow: none i;
                li { c: 0 0 t }
                /// Button shadow.
                ._1azEi::after { box-shadow: bsh i }
                /// Tooltip colors.
                ._2Par4 {
                    c: fg 0 bd;
                    box-shadow: bsh;
                }
            }
            /// Emojis -> Race selection.
            /.P_A-m:not(#z) ul {
                li { &:hover, &._1exov { c: 0 0 t }}
                li:first-child { c: 0 bd }
                + [data-animate-dropdown-nib] {
                    border-bottom: 1px solid bd;
                    border-right: 1px solid bd;
                    bottom: -8px;
                    c: 0 0 hl;
                }
            }
        }
    }

    // App -> Left.
    #side {
        c: 0 0 bg;
        > header {
            border-bottom: 1px solid bd;
            c: 0 0 hl;
        }
        /// Alerts.
        > header + span[class] {
            > div > div {
                border-bottom: 1px solid bd;
                c: 0 0 hl;
            }
            /// Disconnected/connecting.
            ._1UvQg {
                * { c: yellow }
                [data-icon ^= 'chevron-'] path { fill: yellow }
                [data-icon ^= 'alert-'] path {
                    &[fill ^= 'curr'] { fill: yellow }
                    &[fill ^= '#FFB'] { fill: hl }
                }
            }
            /// Enable notifications.
            ._35DHA {
                * { c: blue }
                [data-icon ^= 'chevron-'] path { v: blue }
                [data-icon ^= 'alert-'] path { fill: blue }
                /// Alerts -> Remove 'allow desktop notifications' alert.
                if ( alerts ==  'notifications' ) { display: none i }
            }
            /// Phone battery low.
            ._2t3oV {
                * { c: red }
                [data-icon ^= 'chevron-'] path { v: red }
                [data-icon ^= 'alert-'] path { fill: red }
            }
            /// Close icon.
            ._1cvvW path { fill-opacity: 0.55 }
            /// Alerts -> Remove all alerts.
            if ( alerts ==  'hide' ) { display: none i }
        }
        /// Search.
        /div[class *= 'gQzdc'] {
            transition: 0.2s ease;
            border-bottom: 1px solid bd;
            c: 0 0 hl;
            &._3sdhb { c: 0 0 bg }
            &::after { content: none }
            > div + label {
                rad: radius-i i;
                c: 0 0 bg;
                &:not(:focus-within) { box-shadow: inner }
                input { c: fg 0 t }
                &:focus-within { c: 0 0 t }
            }
            /// Icons -> Close/Loading.
            > span > button { right: 20px i }
            > span > div { right: 22px i }
            /// Remove wrapper background.
            /._2HS9r { c: 0 0 t }
            /// Placeholder text color.
            ._183ES, ._201Bk { c: cm }
        }
        /// Contacts.
        #pane-side {
            c: 0 0 hl;
            /// Items.
            [style *= 'z-index'] > div > div[class] {
                c: 0 0 t;
                /// Active states.
                &:hover { c: 0 0 #55555515 }
                &._1f1zm { c: 0 0 bd }
                /// Remove borders.
                &::after, > div:last-child { border: none }
                /// Text.
                > div:last-child {
                    /// Title/timestamp.
                    > div:first-child {
                        > div:first-child { c: fg }
                        > div:last-child { c: cm }
                    }
                    /// Body.
                    > div:last-child { c: cm }
                    /// Override; all msg content should use lighter color.
                    strong { c: cm }
                }
                /// Unread indicators.
                /.OUeyt { c: white 0 ac }
            }
            /// Remove background glitch of an empty element.
            ._2xINO { height: 0 }
        }
        /// Search contacts/messages.
        ._1AKfk {
            c: ac 0 t;
            box-shadow: 0 1px bd;
        }
        /// Feat -> Blur contacts.
        if ( chat_b_c == 1 ) {
            [style *= 'height'] > div > div[class] {
                filter: blur(6px);
                transition: filter 300ms ease;
                &._3mMX1, &:hover { filter: blur(0px) }
            }
        }
    }

    // App -> Left/right panes.
    ._1-iDe {
        .copyable-area {
            /// Pane background.
            &:not(.overlay) { c: 0 0 hl }
            /// Header.
            header {
                height: unset;
                min-height: unset i;
                border-bottom: 1px solid bd;
                c: 0 0 hl;
                /// Global -> Reset header text.
                /._1xGbt:not(#z) {
                    margin: 0;
                    padding-top: 4px;
                    font-size: 18px;
                    font-weight: 500;
                }
                > div {
                    height: 58px;
                    c: fg;
                    /// Broadcast list info.
                    ._6xQdq { c: fg }
                }
            }
            /// Highlighted sections.
            ._1CRb5 {
                c: 0 0 t;
                box-shadow: none;
                ._1sYdX { c: ac }
                /.Cpiae, /._2EuwQ { c: cm }
                ._3K9Sw { c: 0 t }
                /// Input area border.
                /._31WRs ._1DTd4 { c: 0 ac }
            }
            /// Global -> List items.
            /._2EXPL {
                border-top: 1px solid bd;
                c: 0 0 t;
                > div { border: none i }
                &::after { content: none i }
                &:hover:not(#z):not(._27Ppf) { c: 0 0 #55555510 }
                [style *= 'height: 82px'] { c: 0 0 t }
                ._2WP9Q { border-top: none i }
                /// Nick/info.
                ._25Ooe { c: fg }
                ._3Bxar, ._1AwDx, /._1jd1m { c: cm }
                /// Already blocked.
                &._2EXPL:not(#z) {
                    ._25Ooe { c: fg }
                    ._1AwDx div { c: cm }
                }
                /// Settings -> Reset first list item.
                &._3ntaf { border-top: none i }
                /// Left -> Add group participants.
                &._13iu_ {
                    height: 25px i;
                    &, &:not(#z):hover { c: 0 0 bd }
                    [role = 'button']:hover { c: 0 0 bg }
                }
            }
            /// Settings -> Options.
            ._1CkkN {
                border-bottom: 1px solid bd;
                c: 0 0 t;
                box-shadow: 0 -1px bd;
                &:hover { c: 0 0 #55555510 }
                &::before { content: none }
                > div:last-child { c: 0 t }
                ._3LL06 { c: fg }
            }
            /.wjdTm, ._1qWhd { c: cm }
            /// Left -> New group.
            ._66JgU {
                c: 0 0 t;
                input { c: fg }
                ._3_3Rs { c: 0 bd }
                /// Resets for contacts.
                + div {
                    c: 0 0 t;
                    ._8-yzK { c: 0 0 t }
                }
            }
            /// Left -> New group creation.
            /._1wt6r { c: cm }
            /// Left -> New chat.
            ._1ecJY {
                /// New chat.
                ._2zkF3 { c: 0 0 t }
                ._1AKfk { c: ac 0 t }
                /// New group button.
                /._1jJLh {
                    c: 0 0 ac;
                    /// Expand group participants list button.
                    &.w4k6i {
                        c: 0 0 t;
                        path { fill-opacity: 0.55 }
                    }
                }
                /// Remove borders.
                /._3YwRO { border: none i }
            }
            /// Left -> Starred/Archived.
            .MS-DH {
                &::before {
                    margin-top: -1px;
                    left: 0;
                    c: 0 0 bd;
                }
                &::after { content: none }
                /// States.
                &._1baOM:not(#z) { c: 0 0 bd }
                &._2-mCk, &.ZuHmv { c: 0 0 #55555510 }
                /._3WZoe, ._1bcjS, ._2-rkJ::before { c: cm }
                /// Reset tails.
                .tail {
                    &, > div[class] { rad: 7.5px i }
                    &-container { display: none i }
                }
            }
            /// Right -> Search messages.
            #pane-side { c: 0 0 t }
            /// Blocked contacts.
            ._3hhmj { c: 0 t }
            ._27YTC, /._3dwyT { c: cm }
            ._1i7uJ { c: 0 0 bd }
            /// Contact us.
            /._2rXhY { c: cm }
            /._1BLxK { c: ac 0 t }
            /._2WSfN { c: ac 0 hl }
            /// Version info.
            .ZIgPi { c: fg }
        }
    }

    // App -> Right.
    ._14VS3 .copyable-area {
        /// Default avatar.
        [style *= 'height: 200px'] > div { c: 0 0 bg }
        /// Text color.
        .iYPsH { c: fg }
        ._2IwIk, ._1goQ0, ._2IkcY { c: cm }
        /// Buttons.
        ._14oqx {
            padding: 0;
            > div {
                padding: 0 30px;
                c: 0 bd;
            }
            span { c: fg }
        }
        /// Reset padding.
        ._1ur1f { padding: 28px 15px 19px }
        ._2ZVEo { padding: 14px 15px 10px }
        ._2k1Z5 { padding: 14px 15px 4px }
        ._3EN0l { padding: 14px 15px }
        .ujWpH { padding: 14px 15px }
        ._2nQ7u, ._1goQ0 { padding: 0 }
        ._2nQ7u + div[class] > div { padding-top: 1px }
        ._2LSbZ._2j5ir { margin-bottom: unset }
        ._1tyVr {
            padding: 0 15px;
            width: auto;
        }
        /// Right -> Media, links and docs / Starred messages.
        ._GaHgu {
            path { opacity: 0.55 i }
            /// Hover animation.
            &:hover > span > svg > path {
                opacity: 1 i;
                fill-opacity: 0.9 i;
            }
        }
        /// Message info -> Image.
        ._3FAwT {
            border-bottom: 1px solid bd;
            c: 0 0 t;
        }
        /// Message info -> Read by.
        ._2flas {
            c: 0 0 t;
            span { c: ac }
        }
        /// Message info -> X remaining.
        .Um7sh {
            c: 0 0 t;
            box-shadow: 0 1px bd;
        }
        /// Message info -> Forwarded x time(s).
        ._3E0ID {
            c: fg bd t;
            span { color: inherit }
        }
        /// HACK: Resets.
        ._2feU1:not(._1c8mz):not(#z):not(#x) ._2EXPL {
            // Message info in DMs but not in groups.
            &:hover {
                c: 0 0 t;
                box-shadow: none i;
            }
            /// Add group participants.
            &._27Ppf:hover { c: 0 0 bd }
        }
        /// Read/Delivered section.
        ._2WP9Q { border: none }
        /// Search -> Default message.
        ._3dwyT { c: cm }
        /// Search -> Items on hover.
        [style]:not(#z):not(#x) > div > ._2UaNq {
            &._3sA1g:hover, &._3mMX1, &.hover { c: 0 0 #55555510 }
        }
        /// Search -> Msg content/date.
        span[title] > span[dir] { c: fg }
        /._0LqQ { c: cm }
        /// Starred messages header.
        .BfrqJ > header._3jHKU {
            height: 59px;
            c: 0 0 hl;
            box-shadow: inset 0 -1px bd;
            div { c: fg }
            /// Left -> Fix starred messages menu. @upstream
            /._3jHKU { z-index: 999 i }
        }
        /// Media/Links/Docs -> Selected header.
        .GaHgu {
            c: 0 0 hl;
            box-shadow: inset 0 -1px bd;
            span { c: fg }
        }
        /// Media/Links/Docs -> Content.
        [data-active-tab] {
            border-bottom: 1px solid bd;
            c: 0 0 bg;
            button {
                c: cm;
                &:hover { c: 0 0 hl }
                &._3caqI { c: fg }
            }
            /// Selected.
            &::before {
                margin-bottom: -1px;
                height: 1px;
                c: 0 0 blue;
            }
            /// Selected media.
            /._2mlDB { c: 0 hl }
        }
        /// App -> Fix right pane border.
        /._1-iDe._14VS3 > span { border-left: 1px solid bd }
    }

    // Main -> Chat.
    #main {
        c: 0 0 bg;
        /// Feat -> Chat doodle image.
        /[data-asset-chat-background] {
            opacity: 1 i;
            filter: invert(var(--chat-bg-i)) opacity(var(--chat-bg-o));
            background: var(--chat-image);
            /// Feat -> Show chat image.
            if ( chat_bg != 1 ) { display: none }
        }
        /// Chat header.
        > header {
            border-right: none;
            border-bottom: 1px solid bd;
            c: 0 bd hl;
            &::after { content: none }
            [title] { c: fg }
            /// Muted color for group members.
            > div:nth-child(2) > div:nth-child(2) span[title] { c: cm }
        }
        /// Group -> Description.
        ._3SYkD {
            > div {
                border-bottom: 1px solid bd;
                border-left: 1px solid bd;
                background-color: hl;
            }
            ._6xQdq, ._3GIEC { c: fg }
            ._3D8gv { c: cm }
        }
        /// Chat -> Loader.
        ._3dGYA {
            c: 0 0 hl;
            box-shadow: inner, bsh;
            svg circle { stroke: green }
        }
        /// Chat -> System messages.
        .Zq3Mc {
            opacity: 0.95;
            letter-spacing: 0;
            font-weight: 600;
            text-shadow: none;
            c: fg 0 hl;
            box-shadow: bsh, inner, inset 0 -3px bd;
            &._14b5J { c: orange }
            &:not(.tail) { c: fg }
        }
        /// Chat -> Jump to new messages.
        ._298R6 {
            c: 0 0 hl;
            transition: background 0.15s ease;
            box-shadow: inner, 0 4px 8px sh;
            &:hover { c: 0 0 bd }
            .P6z4j { c: white 0 ac }
        }
        /// Messages area.
        .copyable-area > div[tabindex] {
            c: 0 bd;
            /// Chat -> Fix message spacing reported in #43.
            > [tabindex = '-1'] {
                display: flex i;
                flex-direction: column i;
            }
            /// Chat -> Select messages.
            &._3D9Wd {
                c: 0 0 t;
                [class *= 'message-'] { position: relative }
                /// Selected messages.
                /._1o1sm {
                    z-index: 999 i;
                    /// Pseudo-background.
                    &::before {
                        content: '';
                        opacity: 0.08;
                        position: absolute;
                        top: 0; left: 0; bottom: 0; right: 0;
                    }
                    /// States.
                    &:hover, &._2nOMz {
                        c: 0 0 t;
                        &::before { c: 0 0 ac }
                    }
                }
                /// Checkboxes.
                ._1VD7W {
                    c: 0 ac ac;
                    div { c: 0 white }
                }
                /// Reset icon opacity.
                /._1l9lt {
                    path { opacity: 0.55 i }
                    /// Disabled icons.
                    &:disabled path { fill: cm i; opacity: 0.25 i }
                    /// Animate-ish.
                    &:hover > span > svg > path {
                        opacity: 1 i;
                        fill-opacity: 0.9 i;
                    }
                }
            }
            /// Forwarded message.
            /._15aTv { c: cm }
            /// X unread messages.
            ._1mq8g {
                c: fg bd hl;
                > span { c: 0 0 bd }
            }
            /// Attached files.
            a[title] {
                > ._1mrMQ { c: fg 0 bg }
                + div { &, > span::before { c: cm }}
            }
            /// Rich embeds.
            /._2nFG1, /._2pvbg, /._3mRez, /._1sGGp {
                c: 0 0 bg;
                div > div:nth-child(1) span { c: fg }
                div > div:nth-child(2) span { c: cm }
                div > div:nth-child(3) span { c: fg }
            }
            /// Deleted message.
            ._18dOq, ._1upWv {
                c: cm;
                [data-icon] path { fill: cm }
            }
            /// 'Read more' button.
            /._484uz, /._3BIvq { c: ac }
            /// 'Join group' / 'View all' buttons.
            /._3DBC1 {
                c: 0 #88888830;
                [role = 'button'] { c: fg }
            }
        }
        /// Feat -> Blur img/videos.
        if ( chat_b_img == 1 ) {
            [class *= 'message-'] [style *= 'height'] {
                > img, > div[style], video {
                    transition: 500ms ease;
                    transition-delay: 0ms;
                    filter: blur(16px) grayscale(100%);
                    &:hover {
                        transition-delay: 500ms;
                        filter: none i;
                    }
                }
                /// HACK: Reset blur for videos.
                &[style *= 'width'] > div:first-child:hover ~ div {
                    > video {
                        transition-delay: 500ms;
                        filter: none i;
                    }
                }
                /// HACK: Reset blur for audio msg avatars.
                &[style *= 'width'] > img.jZhyM { filter: none i }
                /// HACK: Reset img timestamp wrapper.
                img[src] + div { pointer-events: none }
            }
        }
        /// Chat -> Documents.
        /._2RBFb {
            c: 0 0 bg;
            /// Stats.
            /._2DwXW { c: cm }
        }
        /// Embeds -> Thumbnail.
        /._3_nIn { c: 0 0 #55555510 }
        /// Embeds -> Text.
        /a[href][target = '_blank'], /._2Lp2x {
            > * { c: cm }
            > :first, > :last { &-child { c: fg }}
        }
        /// Embeds -> Shared contact.
        /._1YNgi {
            div[style *= 'base64'] { filter: none i }
            div[style *= 'height'] { c: 0 0 bg }
            ._3gkvk { c: fg }
            /// Multiple contacts.
            /._3BtGF, /.mc_ET { c: 0 bg t }
            /.AVd_p { c: fg }
        }
    }

    // Main -> Chat message bubbles.
    .message {
        /// Feat -> Custom bubble colors.
        ( chat_b_l == 0 ) ? left  = msg_l : left  = b_l_bg;
        ( chat_b_r == 0 ) ? right = msg_r : right = b_r_bg;
        /// Tails -> Facebook style.
        /// TODO: Refactor later.
        if ( chat_m_t == 'fb-like' ) {
            &-in {
                .tail-container { display: none }
                /// (first|all|last|single) message/s.
                .tail > div { rad: 12px 12px 12px 6px i }
                ._2Wx_5 { rad: 6px 12px 12px 6px i }
                &._4jEk2 + .message-in:not(._4jEk2) {
                    // c: 0 0 ac;
                    ._2Wx_5 { rad: 6px 12px 12px 12px i }
                }
                &:not(._4jEk2) ._2Wx_5 { rad: 12px i }
            }
            &-out {
                .tail-container { display: none }
                /// (first|all|last|single) message/s.
                .tail > div { rad: 12px 12px 6px 12px i }
                ._2Wx_5 { rad: 12px 6px 6px 12px i }
                &._4jEk2 + .message-out:not(._4jEk2) {
                    // c: 0 0 ac;
                    ._2Wx_5 { rad: 12px 6px 12px 12px i }
                }
                &:not(._4jEk2) ._2Wx_5 { rad: 12px i }
            }
        }
        /// Global bubble styles.
        &-in, &-out {
            /// Fix shadows.
            > div:not(._1rK-b) {
                box-shadow: 0 1px 0.5px sh i;
                > div { box-shadow: none i }
            }
            /// Tails.
            .tail > .tail-container {
                width: unset;
                height: unset;
                border: 6px solid t;
                background: none i;
            }
            /// Feat -> Message tails.
            if ( chat_m_t == 'rounded' ) {
                .tail {
                    > div { rad: 7.5px i }
                    .tail-container { display: none }
                }
            } else if ( chat_m_t == 'minimal' ) {
                .tail .tail-container { display: none }
            }
            /// Date.
            [data-pre-plain-text] + div *, /._1DZAH { c: cm }
            /// Reset image context menu.
            &._26GKj ._2Nkc4:not(#z) { background: none i  }
            /// Stickers.
            ._1rK-b {
                /// Header.
                ._2R8MP {
                    c: 0 0 left;
                    box-shadow: 0 1px sh i;
                }
                /// Date.
                ._2Ll5c {
                    c: cm;
                    box-shadow: 0 1px sh i;
                    div { color: inherit }
                }
                /// Fix bubble radius.
                if ( msg_tails != 1 ) {
                    :not(.tail) > div > ._2Hp95._1X6iJ ._2R8MP { rad: 7.5px }
                }
            }
            /// Audio messages.
            ._1lxsr, ._3MYI2 { c: cm }
            /// Avatars.
            [style *= 'height: 55px'] {
                c: 0 0 bg;
                box-shadow: bsh;
                svg path[fill = '#DFE5E7'] { v: t }
            }
            /// Search -> Selected message.
            &.velocity-animating { opacity: 0.4 }
            /// Image/gif -> Timestamp background.
            div[style *= 'width'][style *= 'height'] {
                + ._1uFFm, + .GbMip {
                    padding: 2px 5px;
                    rad: 7.5px;
                    c: 0 0 hl;
                }
            }
            /// Videos -> Timestamp background.
            .video-thumb {
                ._1Ppwx {
                    padding: 2px 5px;
                    rad: 7.5px;
                    c: fg 0 bg;
                }
                + div > [role = 'button'] {
                    padding: 2px 5px;
                    rad: 7.5px;
                    c: fg 0 bg;
                }
                /// Video duration.
                /.Y9G3K { c: cm }
            }
            /// Fix context menu height for shared contacts.
            ._2rg5w._3EQsG { height: 50px }
        }
        /// Left.
        &-in {
            /// Not stickers.
            > div:not(._1rK-b) > div { c: fg 0 left }
            /// Stickers -> Timestamp.
            > div._1rK-b ._2Ll5c { c: 0 0 left }
            /// Stickers -> Sender name bubble. #69
            /._3_9XW {
                c: 0 0 left;
                box-shadow: 0 1px 0.5px sh i;
            }
            /// Reset tails.
            .tail {
                border-top-left-radius: 0 i;
                > .tail-container {
                    rad: 4px 0 0 0;
                    border-top-color: left;
                    border-right-color: left;
                }
            }
            /// Groups -> Nickname.
            [role] > span[role = 'button'] + span { c: fg }
            /// Context menu.
            > div > span:last-child > div[style] {
                /// Non-stickers | Groups -> Combined stickers.
                &:not(._1UyGF), /._1i1U7.jZ4tp {
                    height: 22px i;
                    background: linear-gradient(90deg, t, left 80%) i;
                }
                /// Stickers.
                /._1i1U7._1UyGF div[style *= 'opacity'] { c: 0 0 left }
                /// Audio messages.
                &._15hve { &.jZ4tp, &._2DNgV { background: none i }}
                /// Images/Videos.
                &._20WGU, &.LSBf- {
                    background: linear-gradient(30deg, t 60%, sh) i;
                }
                /// Fix context menu for local RTL layouts.
                &._38wik._2Nkc4 { background: linear-gradient(270deg, t, left 80%) i }
            }
            /// Replies.
            ._1iJeo {
                c: 0 0 bg;
                &:hover { opacity: 0.8 }
            }
            /// Feat -> Align left bubble.
            if ( chat_left == 'end' ) { align-items: flex-end }
        }
        /// Right.
        &-out {
            /// (1) Not stickers; (2) Not error ("couldn't send this message").
            > div:not(._1rK-b) > div:not(._19l4G) { c: fg 0 right }
            /// "Couldn't send this message" tweaks.
            ._19l4G:not(#z) {
                /// Popout message.
                > :first-child:not(:last-child) {
                    c: fg 0 hl;
                    box-shadow: inner, bsh;
                    &::after { border-left-color: bd i }
                }
                /// Button.
                > [role = 'button'] {
                    c: 0 sh red;
                    path[fill = '#FFF'] { v: white }
                }
            }
            /// Stickers -> Timestamp.
            > div._1rK-b ._2Ll5c { c: 0 0 right }
            /// Reset tails.
            .tail {
                border-top-right-radius: 0 i;
                > .tail-container {
                    rad: 0 4px 0 0;
                    border-top-color: right;
                    border-left-color: right;
                }
            }
            /// Context menu.
            > div > span:last-child > div[style] {
                /// Non-stickers.
                &:not(._1qhoQ) { background: linear-gradient(90deg, t, right 80%) i }
                /// Stickers.
                /._1i1U7._1qhoQ div[style *= 'opacity'] { c: 0 0 right }
                /// Shared contacts.
                &._2DNgV.o4dWJ { background: linear-gradient(30deg, t, right) i }
                /// Images/Videos.
                &._20WGU, &.LSBf- {
                    background: linear-gradient(30deg, t 60%, sh) i;
                }
                /// Fix context menu for local RTL layouts.
                &._38wik._3EQsG { background: linear-gradient(270deg, t, right 80%) i }
            }
            /// Context menu -> Forwarded messages.
            > div > span:nth-last-child(2) > div[style] {
                /// Embedded links.
                &._1i1U7 { background: linear-gradient(90deg, t, bg 60%) i }
                /// Files.
                &.jZ4tp { background: linear-gradient(90deg, t, right 80%) i }
            }
            /// Replies.
            ._1iJeo {
                c: 0 0 bg;
                &:hover { opacity: 0.8 }
            }
            /// Feat -> Align right bubble.
            if ( chat_right == 'start' ) { align-items: flex-start }
        }
    }

    // Main -> Upload preview.
    ._1drQ-, ._1dGTK, .r3Nu1 {
        border-left: 1px solid bd i;
        c: 0 0 bg;
        header {
            border-bottom: 1px solid bd;
            c: fg 0 hl;
        }
        /// Input.
        ._7HWvs { c: cm }
        .CzI8E { c: 0 ac }
        /// Alert.
        ._1u0aP {
            c: fg 0 bd;
            box-shadow: bsh i;
        }
        /// Footer.
        > div[tabindex] > div:nth-child(2) {
            border-top: 1px solid bd;
            c: 0 0 hl;
        }
        /// Buttons.
        /[role = 'button'] {
            + ._2sn3C { c: 0 0 hl }
            /// Left -> Remove group participant.
            &._1Dfrr:hover {
                c: 0 0 ac;
                box-shadow: bsh;
            }
            /// Add file.
            &._1ypOz {
                c: ac 0 bg;
                box-shadow: inner i;
                &::after { c: 0 0 ac }
            }
            /// Selected file.
            &._2gZno::after { c: 0 0 ac }
            /// Send.
            &._3hV1n {
                c: 0 0 ac;
                box-shadow: bsh;
                transition: 0.15s ease;
                &:hover { opacity: 0.75 }
            }
        }
        /// Upload skeleton.
        /._2n-96 {
            c: 0 0 bg;
            > div { c: fg bd }
        }
    }

    // Main -> Chat input.
    #main > footer {
        c: 0 0 t;
        > div > div { c: 0 bd }
        /// Icons -> Emojis/gifs/stickers.
        ._1x_c3 {
            /// Overwrite defaults. @upstream
            path { fill-opacity: 0.55 }
            /// Active.
            &.bRYFY path {
                fill-opacity: 1;
                fill: ac;
            }
        }
        // /// Emoji picker.
        /._23EHf {
            c: 0 bd hl;
            box-shadow: inset 0 1px bd i;
            &::before { content: none }
            /// Upload preview emoji picker.
            &.aWTXv {
                margin-bottom: 8px;
                border: 1px solid bd i;
                rad: r i;
                box-shadow: bsh i;
            }
        }
        /// Input area.
        > div:first-child {
            border-top: 1px solid bd;
            c: 0 bd hl;
            div[style] + div[tabindex] {
                rad: radius-i;
                c: 0 bd bg;
                [style *= 'visibility'] {
                    c: cm;
                    /// Hide input placeholder.
                    ../ .focused > div[style] { c: t }
                }
            }
        }
        /// Audio message controls.
        [data-icon = 'ptt'] path { fill-opacity: 0.55 }
        [fill = '#09D261'] { v: green }
        [fill = '#E53935'] { v: red }
        /// Emoji/gif/sticker menu.
        ._1vDUw {
            c: 0 bd;
            /// Header.
            ._1qUma {
                c: 0 0 hl;
                box-shadow: inset 0 1px bd, inset 0 -1px bd;
                div[style *= 'background'] { c: 0 0 ac }
                > :not(._2wn58) {
                    c: cm;
                    /// Inactive tabs.
                    &:not(:hover) path { fill: cm }
                    /// Active tabs.
                    &:hover, ../ ._2wn58 { c: fg }
                }
                /// Active menu.
                ._1Wbpa {
                    height: 1px;
                    c: 0 0 ac;
                }
            }
            /// Body.
            ._3tlsa, ._2HBs4, ._2z7kg {
                c: 0 0 bg;
                /// Search.
                [data-tab] {
                    c: 0 bd bg;
                    label {
                        c: fg bd hl;
                        box-shadow: inner;
                        input { c: fg }
                    }
                }
                /// Header colors.
                ._3xMAk { c: cm }
                /// Gif -> Preloader.
                .zl5TR {
                    rad: 4px;
                    c: 0 0 hl;
                }
                /// Stickers -> Retry button.
                [data-id = 'retry'] { c: ac }
                /// Stickers -> 'No stickers' alert. #128
                /._2Hze1 { c: cm }
            }
            /// Remove wrapper background.
            /._3LFRS { c: 0 0 t }
        }
        /// Chat -> Select messages.
        + span:not([class]) > div {
            border-left: 1px solid bd;
            border-top: 1px solid bd;
            c: 0 0 hl;
        }
        /// Alerts -> Not in your contacts.
        ._2Pown {
            c: fg bd hl;
            [role = 'button'] {
                c: cm 0 bd;
                &:hover {
                    c: fg;
                    box-shadow: 0 4px 8px sh;
                }
            }
        }
        /// Alerts -> Not a group member / Only admins can send messages.
        ._2XiC1 {
            c: cm;
            border-left: 1px solid bd;
        }
        /// Reply.
        .rstyJ {
            c: 0 0 bg;
            box-shadow: bsh, inset 0 1px bd i;
            /// Nickname.
            /._3Ye_R:not(#z) { c: cm }
            /// Content.
            > div:first-child:not(#z) {
                margin: 4px 0 8px 66px;
                c: 0 0 hl;
                div[role] { c: 0 0 hl }
                /.quoted-mention { c: cm }
                /// Add border around replies.
                [class *= 'bg-color'] + [dir] {
                    rad: 0 6px 6px 0 i;
                    box-shadow: inset 0 0 0 1px bd;
                }
                .EebcE + div { box-shadow: inner }
            }
            /// Close button.
            div:last-child {
                position: relative;
                c: 0 0 t;
                /// Add clickable whitespace.
                [role = 'button'] > span > svg {
                    padding: 16px;
                    border-radius: 6px;
                }
            }
        }
        /// Mention popout.
        .Uukb4 {
            c: 0 bd bg;
            box-shadow: 0 -1px bd i;
            &::before { content: none }
            .J6TrU {
                c: fg bd bg;
                &._1g_fA, &:hover { c: 0 0 hl }
            }
            ._3SW-z { c: cm }
        }
        /// Audio message length.
        /._1M0Ew { c: cm }
    }

    // Feat -> Compact mode.
    if ( app_c_m == 1 ) {
        /// Reset height/width if there is an overflow.
        #app > div > .app {
            @media screen and (max-height: 500px) { min-height: auto }
            @media screen and (max-width: 648px) { min-width: auto }
            // > div *:hover { box-shadow: inset 0 0 0 1px crimson i }
        }
        /// Compact mode.
        @media screen and (max-width: app_c_m_w) {
            .two, .three {
                /// Left -> Settings/Contacts.
                > div:nth-child(3) {
                    flex: 0 0 80px i;
                    transition: 0.2s ease;
                    &:hover, &:focus-within { flex: 0 0 30% i }
                }
            }
            .two {
                /// Reset upload preview.
                >  div:nth-child(2) > div:nth-child(2) {
                    flex: 0 0 calc(100% - 80px) i;
                    margin-left: calc(-25% + 80px);
                }
                /// Expand contacts.
                > div:nth-child(3) {
                    min-width: 1px i;
                    transition: 0.3s ease i;
                    transition-delay: 1.2s i;
                    &:hover {
                        min-width: 400px i;
                        transition-delay: var(--c-m-hover) i;
                        flex: 0 0 30% i;
                    }
                }
                /// Settings/Starred/Archived panes.
                > :nth-child(2) > :nth-child(1) {
                    z-index: 201 i;
                    flex: 0 0 30% i;
                    [style][tabindex] { border-right: 1px solid bd i }
                }
            }
            .three {
                /// Reset upload preview.
                >  div:nth-child(2) > div:nth-child(2) {
                    flex: 0 0 calc(100% - 30% - 80px) i;
                    margin-left: calc(-25% + 80px);
                }
                /// Reset chat when info is open.
                > div:nth-child(4) {
                    flex: 0 0 calc(100% - 30% - 80px) i;
                }
                /// Do not expand left pane when right pane is open.
                > div:nth-child(3):hover { flex: 0 0 80px i }
                /// Right -> Info pane.
                ._14VS3 {
                    flex: 0 0 30% i;
                    c: 0 t;
                }
            }
            /// Fix search bar width.
            .gQzdc:not(._3sdhb) label { padding: 0px }
            /// Contacts.
            #side {
                /// Fix header width.
                > header {
                    min-width: 240px;
                    /// Hide notifications.
                    + span { display: none }
                }
                /// Items.
                ._2EXPL {
                    /// Add whitespace to hide message content.
                    > div:last-child { padding-left: 5px i }
                    /// Reverse message content.
                    ._1AwDx {
                        position: relative;
                        flex-direction: row-reverse i;
                        /// Remove margin from status wrapper.
                        ._3Bxar {
                            z-index: 999 i;
                            margin-left: 0 i;
                            position: absolute;
                            left: -41px;
                            bottom: -6px;
                            rad: 50%;
                            ._15G96 { margin: 0 }
                            /// Unread messages indicator.
                            .OUeyt { border: 4px solid hl }
                        }
                        /// Reverse message and icons.
                        ._3Bxar > span {
                            display: flex i;
                            flex-direction: row-reverse i;
                        }
                        /// Remove chevron icon and all status icons.
                        .ZR5SB, ._15G96 > *:not(.OUeyt) { display: none }
                    }
                    /// Typing indicator status.
                    /.vdXUe {
                        overflow: unset i;
                        margin-top: -8px i;
                        margin-left: 0px i;
                        position: absolute;
                        &::before {
                            content: '';
                            z-index: 1;
                            position: absolute;
                            top: -31px; left: -71px;
                            height: 53px;
                            width: 53px;
                            box-shadow: inset 0 0 0 3px green;
                            rad: var(--avatar-r);
                            animation: 2s pulse infinite;
                        }
                    }
                    /// Message status.
                    .a5DO0 {
                        padding: 1.5px;
                        z-index: 101;
                        position: absolute;
                        margin: -2px 0 0 -75px;
                        border: 3px solid hl;
                        c: 0 0 bg;
                        rad: 50%;
                        /// Make SVG smaller.
                        > span > svg {
                            padding: 2px;
                            height: 14px i;
                            width: 14px i;
                        }
                    }
                    /// Active states.
                    &._1f1zm { .OUeyt, .a5DO0 { c: 0 bd }}
                    &:hover:not(._1f1zm) {
                        .OUeyt, .a5DO0 {
                            c: 0 hl;
                            filter: brightness(110%);
                        }
                    }
                }
                /// I wish I could understand why this works.
                ._3j7s9 { min-width: 80px i }
            }
        }
    }

    // Feat -> Theme colors in groups.
    if ( c_g_c == 1 ) {
        :not(#z) .color {
            /._1QjgA { c: ac }
            &-0  { c: blue                               }
            &-1  { c: cyan                               }
            &-2  { c: green                              }
            &-3  { c: violet                             }
            &-4  { c: magenta                            }
            &-5  { c: red                                }
            &-6  { c: orange                             }
            &-7  { c: yellow                             }
            &-8  { c: blue; filter: hue-rotate(20deg)    }
            &-9  { c: cyan; filter: hue-rotate(20deg)    }
            &-10 { c: green; filter: hue-rotate(20deg)   }
            &-11 { c: violet; filter: hue-rotate(20deg)  }
            &-12 { c: magenta; filter: hue-rotate(20deg) }
            &-13 { c: red; filter: hue-rotate(20deg)     }
            &-14 { c: orange; filter: hue-rotate(20deg)  }
            &-15 { c: yellow; filter: hue-rotate(20deg)  }
            &-15 { c: blue; filter: hue-rotate(40deg)    }
            &-16 { c: cyan; filter: hue-rotate(40deg)    }
            &-17 { c: green; filter: hue-rotate(40deg)   }
            &-18 { c: violet; filter: hue-rotate(40deg)  }
            &-19 { c: magenta; filter: hue-rotate(40deg) }
            &-20 { c: red; filter: hue-rotate(40deg)     }
        }
        :not(#z) .bg-color {
            &-0  { c: 0 0 blue                               }
            &-1  { c: 0 0 cyan                               }
            &-2  { c: 0 0 green                              }
            &-3  { c: 0 0 violet                             }
            &-4  { c: 0 0 magenta                            }
            &-5  { c: 0 0 red                                }
            &-6  { c: 0 0 orange                             }
            &-7  { c: 0 0 yellow                             }
            &-8  { c: 0 0 blue; filter: hue-rotate(20deg)    }
            &-9  { c: 0 0 cyan; filter: hue-rotate(20deg)    }
            &-10 { c: 0 0 green; filter: hue-rotate(20deg)   }
            &-11 { c: 0 0 violet; filter: hue-rotate(20deg)  }
            &-12 { c: 0 0 magenta; filter: hue-rotate(20deg) }
            &-13 { c: 0 0 red; filter: hue-rotate(20deg)     }
            &-14 { c: 0 0 orange; filter: hue-rotate(20deg)  }
            &-15 { c: 0 0 yellow; filter: hue-rotate(20deg)  }
            &-15 { c: 0 0 blue; filter: hue-rotate(40deg)    }
            &-16 { c: 0 0 cyan; filter: hue-rotate(40deg)    }
            &-17 { c: 0 0 green; filter: hue-rotate(40deg)   }
            &-18 { c: 0 0 violet; filter: hue-rotate(40deg)  }
            &-19 { c: 0 0 magenta; filter: hue-rotate(40deg) }
            &-20 { c: 0 0 red; filter: hue-rotate(40deg)     }
        }
    }
}
